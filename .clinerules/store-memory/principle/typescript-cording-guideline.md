# TypeScript コーディング規約ガイドライン

このガイドラインは、Clean Code concepts adapted for TypeScriptとGoogle TypeScript Style Guideの要素を統合し、TypeScriptプロジェクトにおける可読性、保守性、一貫性を高めることを目的としています。

## 変数

* 意図が明確で発音しやすく、検索しやすいcamelCaseを使用する。型から明らかな情報は含めない。
* 同じ種類の変数には一貫した語彙を使用する。
* 意味のある名前を与えない変数（マジックストリング、マジックナンバー）は避ける。ESLintなどのツールで検出を支援できる。
* 不要なコンテキストは変数名に含めない。クラス名や型名が示す情報は繰り返さない。
* 短い変数名は、ごく限られたスコープ内でのみ使用を検討する。
* グローバル定数には、大文字のスネークケース (`CONSTANT_CASE`) を使用する。

## 関数

* 関数は一つの責務を持つようにする。複数の処理を行う関数は分割する。
* 関数の引数は可能な限り少なくする（理想は2つ以下）。3つ以上の引数が必要な場合は、オブジェクトリテラルや型エイリアスを使用する。
* 関数名は処理内容を明確に示す動詞句を使用する。何を行うかを具体的に示す名前を選ぶ。
* 関数は一つの抽象レベルのみを持つようにする。詳細な処理は別の関数に抽出する。
* 真偽値フラグを関数の引数として使用しない。機能ごとに個別の関数を作成する。
* 副作用を避ける。関数は入力に基づいて値を返すように設計し、外部の状態を変更する処理は局所化する。
* グローバル関数は汚染しない。既存のプロトタイプを拡張するのではなく、クラスなどを使用する。
* 条件式はカプセル化する。条件の意図を明確にする関数を作成する。
* 否定条件は避ける。肯定的な条件でロジックを表現する。
* 型チェック（`instanceof`など）は避ける。TypeScriptの型システムを活用する。
* 死んだコードは削除する。使用されていないコードは保守の妨げになるため削除する。
* 名前付き関数には関数宣言を優先する。
* コールバックにはアロー関数を優先する。
* 関数のフォーマットは一貫性を保つ。

## オブジェクトとデータ構造

* データのアクセスにはゲッターとセッターを使用することを検討する。値の取得や設定に追加のロジック（バリデーション、ロギングなど）を容易に組み込める。
* クラスのメンバーには適切なアクセス修飾子（`private`, `protected`, `public`）を使用し、可視性を制限する。デフォルトは `public` であるため、意図しない公開を防ぐ。
* 可能な限りイミュータブル（不変）なオブジェクトを好む。`readonly` 修飾子や `as const` などを活用する。
* オブジェクトリテラルの型指定には、型アサーション (`as Foo`) ではなく型アノテーション (`: Foo`) を使用する。

## クラス

* クラスは単一責任の原則に従い、小さく保つ。責務ごとにクラスを分割する。
* メソッドチェインを活用して、より表現豊かで簡潔なコードにする。
* 開放/閉鎖の原則（OCP）に従う。拡張に対して開かれ、修正に対して閉じた設計にする。インターフェースなどを活用する。
* 依存性逆転の原則（DIP）を意識する。具象クラスではなく抽象に依存する。
* クラス宣言はセミコロンで終端しない。
* メソッド宣言はセミコロンで区切らない。
* 不必要なコンストラクターは避ける。
* `#private` フィールドは使用しない。TypeScriptの `private` 修飾子を使用する。

## テスト

* テストは出荷よりも重要である。十分な量のテストを書く。
* F.I.R.S.T.の原則（Fast, Independent, Repeatable, Self-Validating, Timely）に従う。
* 各テストケースは独立しており、特定の状況に焦点を当てる。

## 並行処理

* コールバックよりもPromiseを優先する。Promiseはコールバック地獄を避け、よりクリーンな非同期処理を実現する。
* Promiseよりもasync/await構文をさらに優先する。非同期処理を同期的なコードのように記述できる。

## エラー処理

* エラーのスローとPromiseのリジェクトには、常に `Error` オブジェクト（またはそのサブクラス）を使用する。これにより、スタックトレースなどの情報が保持され、デバッグが容易になる。
* 捕捉したエラーを無視しない。適切にログ出力、ユーザーへの通知、または回復処理を行う。
* リジェクトされたPromiseを無視しない。`.catch()` ハンドラーでエラーを処理する。
* `try` ブロックは焦点を絞り、必要最小限のコードに留める。
* 空の `catch` ブロックは避ける。意図的に無視する場合は、その理由をコメントで明確に示す。

## フォーマット

* 関連する関数（呼び出し元と呼び出し先）はソースコード内で近くに配置する。理想的には、呼び出し元のすぐ下に呼び出し先を配置する。
* プライベートプロパティやメソッドにアンダースコアプレフィックス/サフィックス (`_`) は使用しない。
* 常に明示的にセミコロンで文を終端する。
* デフォルトエクスポートではなく、名前付きエクスポートを使用する。

## コメント

* 自己説明的なコードを優先し、コメントは最小限にする。コードが意図を明確に表現していれば、不要なコメントは避ける。
* 悪いコードにコメントを追加するのではなく、リファクタリングしてコードを改善する。
* コメントアウトされたコードは残さない。バージョン管理システムを活用する。
* ジャーナルコメント（更新履歴など）はバージョン管理システムのログで管理する。
* 位置マーカー（`// ---` など）はノイズになるため避ける。
* 将来の改善点や未完了のタスクは `// TODO:` コメントで示す。

## その他

* `const enum` ではなく、plain `enum` を使用する。
* プロダクションコードに `debugger` 文を含めない。
* `with` キーワードは使用しない。
* 組み込みオブジェクトは変更しない。
* `any` 型の使用は可能な限り避ける。より具体的な型、`unknown` 型、または型ガードを使用する。やむを得ず `any` を使用する場合は、その理由をコメントで明記し、ESLintの警告を抑制する (`// eslint-disable-next-line @typescript-eslint/no-explicit-any`)。
* 空のインターフェース型 (`{}`) の使用は避ける。
* `String`, `Boolean`, `Number` などのラッパーオブジェクトを `new` でインスタンス化しない。型変換には関数形式 (`String(value)`) を使用する。
* 型のみをインポートする場合は `import type` を使用する。
* 名前空間 (`namespace`) ではなく、ES6モジュール (`import`/`export`) を使用する。

## Reference

* [labs42io/clean-code-typescript](https://github.com/labs42io/clean-code-typescript)
* [Google TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html)